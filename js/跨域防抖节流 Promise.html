<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨域 | 笔记栈</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/img/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.0d7c1303.js" as="script"><link rel="preload" href="/assets/js/2.1fe0b50b.js" as="script"><link rel="preload" href="/assets/js/15.5ded3296.js" as="script"><link rel="prefetch" href="/assets/js/10.2978dd1f.js"><link rel="prefetch" href="/assets/js/11.0dbaa531.js"><link rel="prefetch" href="/assets/js/12.32c02705.js"><link rel="prefetch" href="/assets/js/13.109a51a8.js"><link rel="prefetch" href="/assets/js/14.515ca27a.js"><link rel="prefetch" href="/assets/js/16.8bc52c4e.js"><link rel="prefetch" href="/assets/js/17.68df63de.js"><link rel="prefetch" href="/assets/js/18.89b1b877.js"><link rel="prefetch" href="/assets/js/19.901364af.js"><link rel="prefetch" href="/assets/js/20.5481b80d.js"><link rel="prefetch" href="/assets/js/21.2a144945.js"><link rel="prefetch" href="/assets/js/22.70831219.js"><link rel="prefetch" href="/assets/js/23.3b0c302e.js"><link rel="prefetch" href="/assets/js/24.878e1e96.js"><link rel="prefetch" href="/assets/js/25.9ff49721.js"><link rel="prefetch" href="/assets/js/26.093c8bdc.js"><link rel="prefetch" href="/assets/js/27.401b5c78.js"><link rel="prefetch" href="/assets/js/28.dc1c7c43.js"><link rel="prefetch" href="/assets/js/29.40e51e71.js"><link rel="prefetch" href="/assets/js/3.ac9d9143.js"><link rel="prefetch" href="/assets/js/30.b76a99b4.js"><link rel="prefetch" href="/assets/js/31.c3ef67ce.js"><link rel="prefetch" href="/assets/js/32.6c5637f7.js"><link rel="prefetch" href="/assets/js/33.a43732df.js"><link rel="prefetch" href="/assets/js/34.944b27fe.js"><link rel="prefetch" href="/assets/js/35.c2719e80.js"><link rel="prefetch" href="/assets/js/36.db5072a0.js"><link rel="prefetch" href="/assets/js/37.3aac3f33.js"><link rel="prefetch" href="/assets/js/38.ac02531c.js"><link rel="prefetch" href="/assets/js/39.b9d37857.js"><link rel="prefetch" href="/assets/js/4.e05c873c.js"><link rel="prefetch" href="/assets/js/40.750e94fc.js"><link rel="prefetch" href="/assets/js/41.941fe774.js"><link rel="prefetch" href="/assets/js/42.bcdffcaa.js"><link rel="prefetch" href="/assets/js/43.1188d721.js"><link rel="prefetch" href="/assets/js/44.0ba6bb4b.js"><link rel="prefetch" href="/assets/js/45.a98c08d8.js"><link rel="prefetch" href="/assets/js/46.1339ab8c.js"><link rel="prefetch" href="/assets/js/47.1e9f1793.js"><link rel="prefetch" href="/assets/js/48.0b65993c.js"><link rel="prefetch" href="/assets/js/49.98d284b0.js"><link rel="prefetch" href="/assets/js/5.f3e6ed41.js"><link rel="prefetch" href="/assets/js/50.40c11909.js"><link rel="prefetch" href="/assets/js/51.401f93f0.js"><link rel="prefetch" href="/assets/js/52.b0168dbe.js"><link rel="prefetch" href="/assets/js/53.8b60059b.js"><link rel="prefetch" href="/assets/js/54.161c06e4.js"><link rel="prefetch" href="/assets/js/55.afd26206.js"><link rel="prefetch" href="/assets/js/56.55d94850.js"><link rel="prefetch" href="/assets/js/57.ae35ff7c.js"><link rel="prefetch" href="/assets/js/58.96b6abba.js"><link rel="prefetch" href="/assets/js/59.91f247f9.js"><link rel="prefetch" href="/assets/js/6.498ab014.js"><link rel="prefetch" href="/assets/js/60.2b43d161.js"><link rel="prefetch" href="/assets/js/61.9ebe816a.js"><link rel="prefetch" href="/assets/js/62.bc73408a.js"><link rel="prefetch" href="/assets/js/63.f8745496.js"><link rel="prefetch" href="/assets/js/64.4ae7ce85.js"><link rel="prefetch" href="/assets/js/65.23ecc3e4.js"><link rel="prefetch" href="/assets/js/66.1d24d480.js"><link rel="prefetch" href="/assets/js/67.6042bfed.js"><link rel="prefetch" href="/assets/js/68.ed1e1ed8.js"><link rel="prefetch" href="/assets/js/69.28d1024d.js"><link rel="prefetch" href="/assets/js/7.3f5168c2.js"><link rel="prefetch" href="/assets/js/70.5ff6d4e4.js"><link rel="prefetch" href="/assets/js/71.bd57315c.js"><link rel="prefetch" href="/assets/js/72.e93c0d6e.js"><link rel="prefetch" href="/assets/js/73.4229454d.js"><link rel="prefetch" href="/assets/js/74.c2eb2bad.js"><link rel="prefetch" href="/assets/js/75.7eca9a4e.js"><link rel="prefetch" href="/assets/js/76.b83f903e.js"><link rel="prefetch" href="/assets/js/77.b9a22162.js"><link rel="prefetch" href="/assets/js/78.2450176d.js"><link rel="prefetch" href="/assets/js/79.ff4267c4.js"><link rel="prefetch" href="/assets/js/8.0e4354f9.js"><link rel="prefetch" href="/assets/js/80.abebe711.js"><link rel="prefetch" href="/assets/js/81.d8369dc4.js"><link rel="prefetch" href="/assets/js/82.5da13948.js"><link rel="prefetch" href="/assets/js/83.deb172fd.js"><link rel="prefetch" href="/assets/js/84.727650ec.js"><link rel="prefetch" href="/assets/js/85.50b1b4ef.js"><link rel="prefetch" href="/assets/js/86.90bb267e.js"><link rel="prefetch" href="/assets/js/9.de4e9e4c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="笔记栈" class="logo"> <span class="site-name can-hide">笔记栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端基础/第一天html笔记/" class="nav-link">
  html-one
</a></li><li class="dropdown-subitem"><a href="/前端基础/第二天html总结/" class="nav-link">
  html-two
</a></li></ul></li><li class="dropdown-item"><h4>
          css
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端基础/css第一天/" class="nav-link">
  css-one
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第二天/" class="nav-link">
  css-two
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第三天/" class="nav-link">
  css-twree
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第四天/" class="nav-link">
  css-four
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day07-前端基础CSS第五天/" class="nav-link">
  css-five
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day08-前端基础CSS第六天/" class="nav-link">
  css-six
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day09-前端基础CSS第七天/" class="nav-link">
  css-seven
</a></li><li class="dropdown-subitem"><a href="/前端基础/day10-HTML5&amp;CSS3提高/" class="nav-link">
  css html提高
</a></li><li class="dropdown-subitem"><a href="/前端基础/移动端/" class="nav-link">
  移动端
</a></li><li class="dropdown-subitem"><a href="/前端基础/day01/" class="nav-link">
  移动端布局
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/basis/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/js/senior/" class="nav-link">
  JavaScript高级
</a></li><li class="dropdown-item"><!----> <a href="/webapi/webapinew/" class="nav-link">
  webapi新
</a></li><li class="dropdown-item"><!----> <a href="/webapi/pk webapi/" class="nav-link">
  webapi
</a></li><li class="dropdown-item"><!----> <a href="/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/跨域防抖节流 Promise/" class="nav-link">
  跨域防抖节流
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git&amp;ajax&amp;JQ" class="dropdown-title"><span class="title">git&amp;ajax&amp;JQ</span> <span class="arrow down"></span></button> <button type="button" aria-label="git&amp;ajax&amp;JQ" class="mobile-dropdown-title"><span class="title">git&amp;ajax&amp;JQ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/git/Git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/ajax/Ajax/" class="nav-link">
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/jq/JQuery/" class="nav-link">
  JQuery
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node" class="dropdown-title"><span class="title">node</span> <span class="arrow down"></span></button> <button type="button" aria-label="node" class="mobile-dropdown-title"><span class="title">node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/Node入门及模块系统/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/project/大事件/大事件-01/" class="nav-link">
  node大事件
</a></li><li class="dropdown-item"><!----> <a href="/node/NPM/" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/node/接口测试工具/" class="nav-link">
  接口测试工具
</a></li><li class="dropdown-item"><!----> <a href="/node/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/node/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/node/ES6/" class="nav-link">
  es6
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          vue基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/vue基础/笔记/" class="nav-link">
  vue基础
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/03-前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/03-前后端对接/" class="nav-link">
  前后端交互
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/04-前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/05-综合案例/" class="nav-link">
  综合案例
</a></li></ul></li><li class="dropdown-item"><h4>
          vue进阶目录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/vue进阶/vue进阶/" class="nav-link">
  vue进阶
</a></li><li class="dropdown-subitem"><a href="/vue/vuex/outline-vuex/" class="nav-link">
  vuex
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue项目" class="dropdown-title"><span class="title">vue项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue项目" class="mobile-dropdown-title"><span class="title">vue项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          大事件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/大事件/大事件-01/" class="nav-link">
  node大事件
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/project/头条移动/01-头条-Mobile-项目初始化/" class="nav-link">
  头条移动
</a></li><li class="dropdown-item"><!----> <a href="/project/头条综合案例/01-头条-PC-项目初始化/" class="nav-link">
  头条pc综合案例
</a></li><li class="dropdown-item"><!----> <a href="/project/中台/01-HR-项目初始化/" class="nav-link">
  中台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/question/" class="nav-link">
  问题总结小册
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          html
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端基础/第一天html笔记/" class="nav-link">
  html-one
</a></li><li class="dropdown-subitem"><a href="/前端基础/第二天html总结/" class="nav-link">
  html-two
</a></li></ul></li><li class="dropdown-item"><h4>
          css
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端基础/css第一天/" class="nav-link">
  css-one
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第二天/" class="nav-link">
  css-two
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第三天/" class="nav-link">
  css-twree
</a></li><li class="dropdown-subitem"><a href="/前端基础/css第四天/" class="nav-link">
  css-four
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day07-前端基础CSS第五天/" class="nav-link">
  css-five
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day08-前端基础CSS第六天/" class="nav-link">
  css-six
</a></li><li class="dropdown-subitem"><a href="/前端基础/笔记-day09-前端基础CSS第七天/" class="nav-link">
  css-seven
</a></li><li class="dropdown-subitem"><a href="/前端基础/day10-HTML5&amp;CSS3提高/" class="nav-link">
  css html提高
</a></li><li class="dropdown-subitem"><a href="/前端基础/移动端/" class="nav-link">
  移动端
</a></li><li class="dropdown-subitem"><a href="/前端基础/day01/" class="nav-link">
  移动端布局
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/basis/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/js/senior/" class="nav-link">
  JavaScript高级
</a></li><li class="dropdown-item"><!----> <a href="/webapi/webapinew/" class="nav-link">
  webapi新
</a></li><li class="dropdown-item"><!----> <a href="/webapi/pk webapi/" class="nav-link">
  webapi
</a></li><li class="dropdown-item"><!----> <a href="/js/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/js/跨域防抖节流 Promise/" class="nav-link">
  跨域防抖节流
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git&amp;ajax&amp;JQ" class="dropdown-title"><span class="title">git&amp;ajax&amp;JQ</span> <span class="arrow down"></span></button> <button type="button" aria-label="git&amp;ajax&amp;JQ" class="mobile-dropdown-title"><span class="title">git&amp;ajax&amp;JQ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/git/Git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/ajax/Ajax/" class="nav-link">
  ajax
</a></li><li class="dropdown-item"><!----> <a href="/jq/JQuery/" class="nav-link">
  JQuery
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node" class="dropdown-title"><span class="title">node</span> <span class="arrow down"></span></button> <button type="button" aria-label="node" class="mobile-dropdown-title"><span class="title">node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/Node入门及模块系统/" class="nav-link">
  入门
</a></li><li class="dropdown-item"><!----> <a href="/project/大事件/大事件-01/" class="nav-link">
  node大事件
</a></li><li class="dropdown-item"><!----> <a href="/node/NPM/" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/node/接口测试工具/" class="nav-link">
  接口测试工具
</a></li><li class="dropdown-item"><!----> <a href="/node/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/node/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/node/ES6/" class="nav-link">
  es6
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          vue基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/vue基础/笔记/" class="nav-link">
  vue基础
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/03-前端路由/" class="nav-link">
  前端路由
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/03-前后端对接/" class="nav-link">
  前后端交互
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/04-前端工程化/" class="nav-link">
  前端工程化
</a></li><li class="dropdown-subitem"><a href="/vue/vue基础/05-综合案例/" class="nav-link">
  综合案例
</a></li></ul></li><li class="dropdown-item"><h4>
          vue进阶目录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/vue进阶/vue进阶/" class="nav-link">
  vue进阶
</a></li><li class="dropdown-subitem"><a href="/vue/vuex/outline-vuex/" class="nav-link">
  vuex
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue项目" class="dropdown-title"><span class="title">vue项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue项目" class="mobile-dropdown-title"><span class="title">vue项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          大事件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/大事件/大事件-01/" class="nav-link">
  node大事件
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/project/头条移动/01-头条-Mobile-项目初始化/" class="nav-link">
  头条移动
</a></li><li class="dropdown-item"><!----> <a href="/project/头条综合案例/01-头条-PC-项目初始化/" class="nav-link">
  头条pc综合案例
</a></li><li class="dropdown-item"><!----> <a href="/project/中台/01-HR-项目初始化/" class="nav-link">
  中台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="问题" class="dropdown-title"><span class="title">问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="问题" class="mobile-dropdown-title"><span class="title">问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/question/question/" class="nav-link">
  问题总结小册
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>跨域</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#跨域" class="sidebar-link">跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#同源策略" class="sidebar-link">同源策略</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#解决跨域" class="sidebar-link">解决跨域</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#防抖和节流" class="sidebar-link">防抖和节流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#防抖" class="sidebar-link">防抖</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#节流" class="sidebar-link">节流</a></li></ul></li><li><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#es6-降级处理" class="sidebar-link">ES6 降级处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#promise" class="sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#回调地狱" class="sidebar-link">回调地狱</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#promise-简介" class="sidebar-link">Promise 简介</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#promise-简单使用" class="sidebar-link">Promise 简单使用</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#then-方法的链式调用" class="sidebar-link">then 方法的链式调用</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#封装按顺序异步读取文件的函数" class="sidebar-link">封装按顺序异步读取文件的函数</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#async-和-await-修饰符" class="sidebar-link">async 和 await 修饰符</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#promise-小结" class="sidebar-link">Promise 小结</a></li></ul></li><li><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#身份认证-了解" class="sidebar-link">身份认证（了解）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#开发模式" class="sidebar-link">开发模式</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#演示传统的服务端渲染模式" class="sidebar-link">演示传统的服务端渲染模式</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/js/%E8%B7%A8%E5%9F%9F%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81%20Promise.html#session-身份认证" class="sidebar-link">Session 身份认证</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h2> <h3 id="同源策略"><a href="#同源策略" class="header-anchor">#</a> 同源策略</h3> <p>编程中的同源，比较的是两个 url 是否同源。</p> <p>主要看下面三个方面：</p> <ul><li><strong>协议</strong>是否相同（http https file）</li> <li><strong>主机地址</strong>是否相同（www.xxx.com 127.0.0.1）</li> <li><strong>端口</strong>（0~65535）（http 默认端口是 80；https 默认端口是 443；MySQL 默认端口 3306）</li></ul> <p>如果两个 url 的协议、主机地址、端口都相同，那么这两个 url 是同源的，否则就是非同源。</p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20210126083715294.png" alt="image-20210126083715294"></p> <p>违反了同源策略的请求，叫做<strong>跨域请求</strong>。</p> <p>如果非同源，那么以下三种行为会受到限制：</p> <ul><li>Cookie 无法操作</li> <li>DOM 无法操作</li> <li><strong>Ajax 请求无效</strong>（请求可以发送，服务器也会处理这次请求，但是响应结果会被浏览器拦截）</li></ul> <h3 id="解决跨域"><a href="#解决跨域" class="header-anchor">#</a> 解决跨域</h3> <p>主流的方案有两种：分别是 JSONP 和 CORS.</p> <h4 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h4> <p>是程序员被迫想出来的解决跨域的方案。</p> <p>JSONP 方案和 Ajax 没有任何关系</p> <p>JSONP 方案只支持 GET 请求</p> <p>JSONP 没有浏览器兼容问题，任何浏览器都支持。</p> <ul><li><p>原理</p> <ul><li>客户端利用 script 标签的 src 属性，去请求一个接口，因为 src 属性不受跨域影响。</li> <li>服务端响应一个字符串</li> <li>客户端接收到字符串，然后把它当做 JS 代码运行。</li></ul> <p>后端接口代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/jsonp&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// res.send('hello');</span>
  <span class="token comment">// res.send('console.log(1234)');</span>
  <span class="token comment">// res.send('abc()')</span>
  <span class="token comment">// res.send('abc(12345)')</span>

  <span class="token comment">// 接收客户端的函数名</span>
  <span class="token keyword">let</span> fn <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">&quot;登录成功&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fn <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>前端代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 提前准备好一个函数</span>
  <span class="token keyword">function</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:3006/api/jsonp?callback=xxx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>前端需要做什么？</p> <ul><li>如果使用 jQuery，$.ajax({ <strong>dataType: 'jsonp'</strong> })，必须指定 dataType 选项为 jsonp 即可</li></ul></li> <li><p>后端需要做什么？</p> <ul><li>如果使用 express，那么直接调用 <code>res.jsonp(数据)</code> 即可。</li></ul></li></ul> <h4 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h4> <p>由于 XHR 对象被 W3C 标准化之后，提出了很多 XHR Level2 的新构想，其中新增了很多新方法（onload、response....）和 CORS 跨域资源共享。浏览器升级后开始支持 CORS 方案，从 IE10 开始支持。</p> <p><strong>CORS 方案，就是通过服务器设置响应头来实现跨域</strong>。</p> <p>CORS 才是解决跨域的真正解决方案。</p> <ul><li>前端需要做什么？
<ul><li>无需做任何事情，正常发送 Ajax 请求即可。</li></ul></li> <li>后端需要做什么？
<ul><li>需要加<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS" target="_blank" rel="noopener noreferrer">响应头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。或者使用第三方模块 <strong>cors</strong> 。</li></ul></li></ul> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <table><thead><tr><th>方案</th> <th>前端</th> <th>后端</th></tr></thead> <tbody><tr><td>CORS</td> <td>×</td> <td>设置响应头</td></tr> <tr><td>JSONP（原生）</td> <td>1. 准备一个函数；2. 使用 script 的 src 发送请求</td> <td>响应函数调用</td></tr> <tr><td>JSONP（jQuery）</td> <td>1. 还是调用$.ajax()；2. 必须指定 dataType: 'jsonp'</td> <td>res.jsonp(数据)</td></tr></tbody></table> <h2 id="防抖和节流"><a href="#防抖和节流" class="header-anchor">#</a> 防抖和节流</h2> <p>防抖和节流，作用类似，都是为了提高项目的性能。</p> <h3 id="防抖"><a href="#防抖" class="header-anchor">#</a> 防抖</h3> <p>当事件触发之后，约定单位时间（比如 1s）之后，执行里面的代码；如果在单位时间只内再次触发了事件，那么要<code>重新计时</code>，以保证事件里面的代码只<strong>执行一次</strong>。</p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20210125164236632.png" alt="image-20210125164236632"></p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20210126094601615.png" alt="image-20210126094601615"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">*</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">#box</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 20px auto<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">ul,
  li</span> <span class="token punctuation">{</span>
    <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">input</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">li:hover</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> beige<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">ul</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ipt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./template-web.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 搜索建议模板 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tpl-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span><span class="token punctuation">{</span>each result item<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token operator">/</span>each<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 当输入框的键盘弹起的时候，发送请求，获取搜索建议</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#ipt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清楚前面的定时器</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取输入的值（搜索关键字）</span>
    <span class="token keyword">let</span> keywords <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>keywords <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果关键字不为空，则获取搜索建议</span>
    <span class="token comment">// 约定 1s 之后发送请求</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">&quot;https://suggest.taobao.com/sug&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span> q<span class="token operator">:</span> keywords<span class="token punctuation">,</span> code<span class="token operator">:</span> <span class="token string">&quot;utf-8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 加入code参数，能够搜索多个汉字</span>
        dataType<span class="token operator">:</span> <span class="token string">&quot;jsonp&quot;</span><span class="token punctuation">,</span> <span class="token comment">// JSONP请求必须加这项</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(res)</span>
          <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">&quot;tpl-list&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="节流"><a href="#节流" class="header-anchor">#</a> 节流</h3> <p>当事件触发之后，约定单位时间之内，事件里面的<code>代码最多只能执行 1 次</code>。</p> <p>所以，节流减少了单位时间内代码的执行次数，从而提高性能。</p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20210125164258892.png" alt="image-20210125164258892"></p> <p><img src="%E5%85%B6%E4%BB%96.assets/image-20210126102632398.png" alt="image-20210126102632398"></p> <p>使用 timer 当做开关（节流阀）。</p> <ul><li>开关 打开状态（timer = null），则允许执行代码。</li> <li>开关是关闭状态（timer = 数字），则不允许执行代码。</li></ul> <p>代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">html,
  body</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">img</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./angel.gif<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null，表示节流阀打开状态，允许执行事件里面的代码</span>

  <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当事件触发了，判断一下，节流阀的状态，如果是关闭状态，则不允许创建另一个定时器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
      <span class="token keyword">let</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
      <span class="token comment">// 设置图片的css（left和top）</span>
      img<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> x <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">,</span> top<span class="token operator">:</span> y <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 当定时器执行完毕，重新打开节流阀</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="es6-降级处理"><a href="#es6-降级处理" class="header-anchor">#</a> ES6 降级处理</h2> <p>因为 ES 6 有浏览器兼容性问题，可以使用一些工具进行降级处理，例如：<strong>babel</strong></p> <ul><li><p>降级处理 babel 的使用步骤</p> <ol><li>安装 Node.js</li> <li>命令行中安装 babel</li> <li>配置文件 <code>.babelrc</code></li> <li>运行</li></ol></li> <li><p>项目初始化 (项目文件夹不能有中文)</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> init -y
</code></pre></div></li> <li><p>在命令行中，安装 babel <a href="https://babeljs.io" target="_blank" rel="noopener noreferrer">babel 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>  @babel/core @babel/cli @babel/preset-env
</code></pre></div></li> <li><p>配置文件 <code>.babelrc</code> (手工创建这个文件)</p> <p>babel 的降级处理配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在命令行中，运行</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 把转换的结果输出到指定的文件</span>
npx babel index.js -o test.js
<span class="token comment"># 把转换的结果输出到指定的目录</span>
npx babel 包含有js的原目录 -d 转换后的新目录
</code></pre></div></li></ul> <h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <p>Promise 能够处理异步程序。</p> <h3 id="回调地狱"><a href="#回调地狱" class="header-anchor">#</a> 回调地狱</h3> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20191214143315722-9215235.png" alt="image-2019114115722"></p> <p>JS 中或 node 中，都大量的使用了回调函数进行异步操作，而异步操作什么时候返回结果是不可控的，如果我们希望几个异步请求按照顺序来执行，那么就需要将这些异步操作嵌套起来，嵌套的层数特别多，就会形成<strong>回调地狱</strong> 或者叫做 <strong>横向金字塔</strong>。</p> <p>下面的案例就有回调地狱的意思：</p> <p>案例：有 a.txt、b.txt、c.txt 三个文件，使用 fs 模板按照顺序来读取里面的内容，代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将读取的a、b、c里面的内容，按照顺序输出</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取a文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 读取b文件</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./b.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 读取c文件</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./c.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>案例中，只有三个文件，试想如果需要按照顺序读取的文件非常多，那么嵌套的代码将会多的可怕，这就是回调地狱的意思。</p></blockquote> <h3 id="promise-简介"><a href="#promise-简介" class="header-anchor">#</a> Promise 简介</h3> <ul><li>Promise 对象可以解决回调地狱的问题</li> <li>Promise 是异步编程的一种解决方案，比传统的解决方案（回调函数和事件）更合理和更强大</li> <li><code>Promise可以理解为一个容器，里面可以编写异步程序的代码</code></li> <li>从语法上说，Promise 是一个对象，使用的使用需要 <code>new</code></li></ul> <h3 id="promise-简单使用"><a href="#promise-简单使用" class="header-anchor">#</a> Promise 简单使用</h3> <p>Promise 是“承诺”的意思，实例中，它里面的异步操作就相当于一个承诺，而承诺就会有两种结果，要么完成了承诺的内容，要么失败。</p> <p>所以，使用 Promise，分为两大部分，首先是有一个承诺（异步操作），然后再兑现结果。</p> <p>第一部分：定义“承诺”</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实例化一个Promise，表示定义一个容器，需要给它传递一个函数作为参数，而该函数又有两个形参，通常用resolve和reject来表示。该函数里面可以写异步请求的代码</span>
<span class="token comment">// 换个角度，也可以理解为定下了一个承诺</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 形参resolve，单词意思是 完成</span>
  <span class="token comment">// 形参reject ，单词意思是 失败</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 失败，就告诉别人，承诺失败了</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 成功，就告诉别人，承诺实现了</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第二部分：获取“承诺”的结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过调用 p 的then方法，可以获取到上述 “承诺” 的结果</span>
<span class="token comment">// then方法有两个函数类型的参数，参数1表示承诺成功时调用的函数，参数2可选，表示承诺失败时执行的函数</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>完整的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// promise 承诺</span>

<span class="token comment">// 使用Promise分为两大部分</span>

<span class="token comment">// 1. 定义一个承诺</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// resolve -- 解决，完成了; 是一个函数</span>
  <span class="token comment">// reject  -- 拒绝，失败了; 是一个函数</span>
  <span class="token comment">// 异步操作的代码，它就是一个承诺</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 兑现承诺</span>
<span class="token comment">// p.then(</span>
<span class="token comment">//     (data) =&gt; {}, // 函数类似的参数，用于获取承诺成功后的数据</span>
<span class="token comment">//     (err) =&gt; {} // 函数类型的参数，用于或承诺失败后的错误信息</span>
<span class="token comment">// );</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="then-方法的链式调用"><a href="#then-方法的链式调用" class="header-anchor">#</a> then 方法的链式调用</h3> <ul><li><p>前一个 then 里面返回的字符串，会被下一个 then 方法接收到。但是没有意义；</p></li> <li><p>前一个 then 里面返回的 Promise 对象，并且调用 resolve 的时候传递了数据，数据会被下一个 then 接收到</p></li> <li><p>前一个 then 里面如果没有调用 resolve，则后续的 then 不会接收到任何值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// promise 承诺</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>catch 方法可以统一获取错误信息</p></blockquote></li></ul> <h3 id="封装按顺序异步读取文件的函数"><a href="#封装按顺序异步读取文件的函数" class="header-anchor">#</a> 封装按顺序异步读取文件的函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./c.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="async-和-await-修饰符"><a href="#async-和-await-修饰符" class="header-anchor">#</a> async 和 await 修饰符</h3> <p>ES6 --- ES2015</p> <p>async 和 await 是 ES2017 中提出来的。</p> <p>异步操作是 JavaScript 编程的麻烦事，麻烦到一直有人提出各种各样的方案，试图解决这个问题。</p> <p>从最早的回调函数，到 Promise 对象，再到 Generator 函数，每次都有所改进，但又让人觉得不彻底。它们都有额外的复杂性，都需要理解抽象的底层运行机制。</p> <p>异步 I/O 不就是读取一个文件吗，干嘛要搞得这么复杂？<strong>异步编程的最高境界，就是根本不用关心它是不是异步。</strong></p> <p>==async 函数就是隧道尽头的亮光，很多人认为它是异步操作的终极解决方案==。</p> <p>ES2017 提供了 async 和 await 关键字。await 和 async 关键词能够将异步请求的结果以返回值的方式返回给我们。</p> <ul><li>async 用于修饰一个 function</li> <li>async 修饰的函数，一般表示该函数里面有异步操作（Promise 的调用）</li> <li><code>await和async需要配合使用，没有async修饰的函数中使用await是没有意义的，会报错</code></li> <li>await 需要定义在 async 函数内部，await 后面跟的一般都是一个函数（函数里面包含有 Promise）的调用</li> <li>await 修饰的异步操作，可以使用返回值的方式去接收异步操作的结果</li> <li>如果有哪一个 await 操作出错了，会中断 async 函数的执行</li></ul> <p>总结来说：<strong>async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将异步读取文件的代码封装</span>
<span class="token keyword">function</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myReadFile</span><span class="token punctuation">(</span><span class="token string">&quot;./c.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="promise-小结"><a href="#promise-小结" class="header-anchor">#</a> Promise 小结</h3> <ol><li>封装函数
<ul><li>函数中返回 Promise 对象
<ul><li>Promise 对象里面写你的<code>异步代码</code></li></ul></li></ul></li> <li>使用 async 修改一个函数
<ul><li>函数里面使用 await 修饰 Promise 对象（调用前面封装的函数）</li> <li>以返回值的方式获取异步代码成功的结果了</li></ul></li></ol> <h2 id="身份认证-了解"><a href="#身份认证-了解" class="header-anchor">#</a> 身份认证（了解）</h2> <h3 id="开发模式"><a href="#开发模式" class="header-anchor">#</a> 开发模式</h3> <ul><li>传统的服务端渲染模式
<ul><li>后端的接口和前端的代码在一起（服务器）</li> <li>涉及不到跨域</li> <li>有利于 SEO</li> <li>客户端（前端）不需要渲染数据，如果是手机，将会非常省电。运行速度非常快。</li> <li>缺点是开发效率低。</li> <li>适合使用 <strong>cookie</strong> 或 <strong>session</strong> 身份认证</li></ul></li> <li>新型的前后端分离模式
<ul><li>前端代码单独在一个文件夹（服务器）（自己的电脑上）</li> <li>后端的接口在另外的文件夹（服务器）（刘龙宾老师的服务器上）</li> <li>开发速度快，适合多人协作开发。</li> <li>适合使用 <strong>JWT（json web token）</strong> 方式的身份认证。</li></ul></li></ul> <blockquote><p>PS：一个项目到底该使用哪种开发模式？</p> <ul><li>不能一概而论，比如有的网站，首页为了 SEO 采用传统的服务端渲染模式，其他页面采用前后端分离模式。</li> <li>后台管理系统，涉及不到 SEO，可以采用前后端分离模式。</li> <li>小型企业网站，可以采用传统的服务端渲染模式。</li></ul></blockquote> <h3 id="演示传统的服务端渲染模式"><a href="#演示传统的服务端渲染模式" class="header-anchor">#</a> 演示传统的服务端渲染模式</h3> <ul><li><p>最大的特点</p></li> <li><p>服务端代码和前端代码在同一个服务器（文件夹）</p></li> <li><p>搭建服务器</p> <div class="language- extra-class"><pre class="language-text"><code>| - app.js               (搭建服务器)
| - public               (public文件夹用于存放前端页面)
	| - index.html       (一个前端的html页面)
</code></pre></div></li> <li><p>app.js 编写接口 <code>/index.html</code></p> <ul><li>接口中，使用 fs 读取文件，并替换内容，最后响应给客户端</li> <li>客户端请求 <code>http://localhost:3006/index.html</code></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 接口，提供index.html 页面</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 客户端发来请求，希望看到index.html 页面。</span>
  <span class="token comment">// 服务器，把html页面读取出来，把读取的结果响应给客户端即可</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./public/index.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token comment">// console.log(data);</span>
    <span class="token comment">// 假设从数据库中查询到了标题和内容</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{{title}}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;咏鹅&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{{content}}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;鹅鹅鹅，曲项向天歌&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>页面中的数据，是在服务端完成渲染的，客户端接收到的已经是一个包含数据的完整页面了，所以叫做服务端渲染模式。</p></blockquote> <h3 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h3> <h4 id="原理图"><a href="#原理图" class="header-anchor">#</a> 原理图</h4> <p>身份认证，要完成的是：不登录，不允许访问其他页面。</p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20201014100435909.png" alt="image-20201014035909"></p> <h4 id="实现身份认证"><a href="#实现身份认证" class="header-anchor">#</a> 实现身份认证</h4> <ul><li>搭建基础的服务器（或者直接使用前面的 <strong><em>传统服务端渲染模式</em></strong> 代码）</li> <li>中间件配置 cookie-parser
<ul><li><code>app.use(cookieParser())</code></li></ul></li> <li>模拟一个登录接口
<ul><li>如果登录成功，设置 cookie。<code>res.cookie('key', 'value', 配置项);</code></li></ul></li> <li>/index.html 接口中，根据 cookie 判断是否登录，从而完成身份认证</li></ul> <blockquote><p>详见代码</p></blockquote> <h4 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h4> <ul><li>优点
<ul><li>体积小</li> <li>客户端存放，不占用服务器空间</li> <li>浏览器会<code>自动</code>携带，不需要写额外的代码，比较方便</li></ul></li> <li>缺点
<ul><li>客户端保存，安全性较低。但可以存放加密的字符串来解决</li> <li>只能存字符串，cookie 的大小也是有限制的</li> <li>可以实现跨域，但是难度大，难理解，代码难度高</li> <li>不适合前后端分离式的开发</li></ul></li></ul> <h4 id="适用场景"><a href="#适用场景" class="header-anchor">#</a> 适用场景</h4> <ul><li>传统的服务器渲染模式</li> <li>存储安全性较低的数据，比如视频播放位置等</li></ul> <h3 id="session-身份认证"><a href="#session-身份认证" class="header-anchor">#</a> Session 身份认证</h3> <h4 id="原理图-2"><a href="#原理图-2" class="header-anchor">#</a> 原理图</h4> <p>要实现的效果：不登录，不允许访问其他接口</p> <p><img src="https://gitee.com/ye-xingchen/tuchuang/raw/master/img/image-20201014100403755.png" alt="image-202010141403755"></p> <h4 id="实现身份认证-2"><a href="#实现身份认证-2" class="header-anchor">#</a> 实现身份认证</h4> <ul><li><p>搭建基础的服务器</p> <ul><li>下载安装第三方模块 <code>express</code> 和 <code>express-session</code></li> <li>创建 app.js</li> <li>加载所需模块
<ul><li><code>const express = require('express');</code></li> <li><code>const session = require('express-session');</code></li></ul></li></ul></li> <li><p>中间件配置 session</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    secret<span class="token operator">:</span> <span class="token string">&quot;adfasdf&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 这个随便写</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    resave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>完成登录接口</p> <ul><li><p>如果登录成功，使用 session 记录用户信息。</p> <div class="language-js extra-class"><pre class="language-js"><code>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>isLogin <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">&quot;laotang&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>/index.html 接口中，根据 session 判断是否登录，从而完成身份认证</p></li></ul> <blockquote><p>详见代码</p></blockquote> <h4 id="优缺点-2"><a href="#优缺点-2" class="header-anchor">#</a> 优缺点</h4> <ul><li>优点
<ul><li>服务端存放，安全性较高</li> <li>浏览器会自动携带 cookie，不需要写额外的代码，比较方便</li> <li>适合服务器端渲染模式</li></ul></li> <li>缺点
<ul><li>会占用服务器端空间</li> <li>session 实现离不开 cookie，如果浏览器禁用 cookie，session 不好实现</li> <li>不适合前后端分离式的开发</li></ul></li></ul> <h4 id="适用场景-2"><a href="#适用场景-2" class="header-anchor">#</a> 适用场景</h4> <ul><li>传统的服务器渲染模式</li> <li>安全性要求较高的数据可以使用 session 存放，比如用户私密信息、验证码等</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0d7c1303.js" defer></script><script src="/assets/js/2.1fe0b50b.js" defer></script><script src="/assets/js/15.5ded3296.js" defer></script>
  </body>
</html>
